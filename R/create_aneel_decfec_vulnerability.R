#' Creates Aneel - DEC e FEC Vulnerability
#'
#' This function transform the aneel_decfec_wider data and summarizes all vulnerabilities
#' at UF, region, and country view per stats.
#'
#' @param aneel_decfec_wider Aneel - DEC e FEC data transformed in wider data.
#'
#' @returns A dataframe
#' @export
#'
#' @examples
#' \dontrun{
#'   aneel_decfec_summarized_by_vulnerability <- create_aneel_perdas_vulnerability(
#'     dir = "data_aneel"
#'   )
#' }
create_aneel_decfec_vulnerability <- function(aneel_decfec_wider){

  aneel_decfec_summarized_by_vulnerability <- aneel_decfec_wider |>
    dplyr::select(
      geo, geo_value, ano, tipo_de_outorga, dec_apurado, dec_limite,
      fec_apurado, fec_limite
    ) |>
    janitor::clean_names() |>
    dplyr::rename(
      aggregation = tipo_de_outorga,
      "DECA" = dec_apurado,
      "DECL" = dec_limite,
      "FECA" = fec_apurado,
      "FECL" = fec_limite
    ) |>
    tidyr::pivot_longer(
      cols = -c(geo, geo_value, ano, aggregation),
      names_to = "variable_id",
      values_to = "stats_value"
    ) |>
    dplyr::mutate(
      database = "aneel_decfec",
      time_period = "year",
      stats_name = "AVG"
    ) |>
    dplyr::rename(
      "time" = ano
    ) |>
    dplyr::relocate(
      database,
      time_period,
      time,
      aggregation,
      geo,
      geo_value,
      variable_id,
      stats_name
    )

}
